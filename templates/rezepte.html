{% extends "base.html" %}

{% block content %}
<h1>Rezepte</h1>

{% if message %}
<p><strong>{{ message }}</strong></p>
{% endif %}

<hr>

<h2>âœ… Passende Rezepte (0 fehlende Zutaten)</h2>

{% if exact and exact|length > 0 %}
<div class="row recipe-row">
  {% for r in exact %}
  <div class="col-xs-12 col-sm-6 col-md-4">
    <div class="thumbnail recipe-card">
      <button class="pin-btn" data-rezept-id="{{ r.id }}" title="Zur Backstube hinzufÃ¼gen">
        <img class="pin-icon" src="{{ url_for('static', filename='noun-dough-selected.svg') }}" alt="w">
      </button>
      <img src="https://via.placeholder.com/400x250?text=Rezept" alt="Rezeptbild">
      <div class="caption">
        <h3>{{ r.titel }}</h3>
        <p>{{ r.website_name }}</p>
        <p><strong>Fehlende Zutaten: {{ r.missing }}</strong></p>
        <p>
          <a href="{{ r.link }}" class="btn btn-primary" target="_blank">Zum Rezept</a>

        </p>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p><em>keine Ergebnisse</em></p>
{% endif %}

<hr>

<h2>ðŸŸ¡ Fast passende Rezepte (brauchen noch Zutaten)</h2>

{% if almost and almost|length > 0 %}
<div class="row recipe-row">
  {% for r in almost %}
  <div class="col-xs-12 col-sm-6 col-md-4">
    <div class="thumbnail recipe-card">
      <button class="pin-btn" data-rezept-id="{{ r.id }}" title="Zur Backstube hinzufÃ¼gen">
        <img class="pin-icon" src="{{ url_for('static', filename='noun-dough-selected.svg') }}" alt="W">
      </button>
      <img src="https://via.placeholder.com/400x250?text=Rezept" alt="Rezeptbild">
      <div class="caption">
        <h3>{{ r.titel }}</h3>
        <p>{{ r.website_name }}</p>
        <p><strong>Fehlende Zutaten: {{ r.missing }}</strong></p>
        <p>
          <a href="{{ r.link }}" class="btn btn-primary" target="_blank">Zum Rezept</a>

        </p>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p><em>keine fast passenden Rezepte gefunden</em></p>
{% endif %}
<script>
  document.querySelectorAll(".pin-btn").forEach(btn => {
    btn.addEventListener("click", async (e) => {
      e.preventDefault();

      const rezeptId = btn.dataset.rezeptId;
      const formData = new FormData();
      formData.append("rezept_id", rezeptId);

      const res = await fetch("/backstube/toggle", {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      // UI-Update (grÃ¼ner Rand wenn gespeichert)
      if (data.saved) btn.classList.add("saved");
      else btn.classList.remove("saved");
    });
  });
</script>
<hr>

<a href="/zutaten" class="btn btn-default">ZurÃ¼ck zu Zutaten</a>

{% endblock %}