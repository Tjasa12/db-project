{% extends "base.html" %}

{% block content %}
<div>
  <h1>Willkommen bei BNZ! {{Template_test}}</h1>
  <p>Dies ist Ihre persönliche Backstube.</p>
  <p>Um loszulegen, schauen Sie sich einfach die Rezepte an oder wählen sie diese via Zutaten aus.</p>
  <a href="/zutaten" class="btn btn-pink">Zutaten</a>
  <a href="/backstube" class="btn btn-pink">Backstube</a>
</div>
<br><br>
<div>
  {% if all and all|length > 0 %}
  <div class="row recipe-row">
    {% for r in all %}
    <div class="col-xs-12 col-sm-6 col-md-4">
      <div class="thumbnail recipe-card">
        <button class="pin-btn" data-rezept-id="{{ r.id }}" title="Zur Backstube hinzufügen">
          <img class="pin-icon" src="{{ url_for('static', filename='noun-dough-selected.svg') }}" alt="w">
        </button>
        <img src="https://via.placeholder.com/400x250?text=Rezept" alt="Rezeptbild">
        <div class="caption">
          <h3>{{ r.titel }}</h3>
          <p>{{ r.website_name }}</p>
          <p><strong>Fehlende Zutaten: {{ r.missing }}</strong></p>
          <p>
            <a href="{{ r.link }}" class="btn btn-primary" target="_blank">Zum Rezept</a>
            <a href="/like/{{ r.id }}" class="btn btn-pink">
              ❤️ {{ like_counts.get(r.id, 0) }}
            </a>
          </p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p><em>keine Ergebnisse</em></p>
  {% endif %}
</div>
<script>
  document.querySelectorAll(".pin-btn").forEach(btn => {
    btn.addEventListener("click", async (e) => {
      e.preventDefault();

      const rezeptId = btn.dataset.rezeptId;
      const formData = new FormData();
      formData.append("rezept_id", rezeptId);

      const res = await fetch("/backstube/toggle", {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      // UI-Update (grüner Rand wenn gespeichert)
      if (data.saved) btn.classList.add("saved");
      else btn.classList.remove("saved");
    });
  });
</script>

{% endblock %}